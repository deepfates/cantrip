{
  "name": "happy_two_turns",
  "steps": [
    {
      "request": {
        "jsonrpc": "2.0",
        "id": 1,
        "method": "initialize",
        "params": { "protocolVersion": 1 }
      },
      "expect": {
        "response_count": 1,
        "result_protocol_version": 1,
        "responses": [
          {
            "jsonrpc": "2.0",
            "id": 1,
            "result": {
              "protocolVersion": 1,
              "agentCapabilities": {
                "promptCapabilities": { "image": false },
                "loadSession": false
              }
            }
          }
        ]
      }
    },
    {
      "request": {
        "jsonrpc": "2.0",
        "id": 2,
        "method": "session/new",
        "params": { "cwd": "/tmp" }
      },
      "expect": {
        "response_count": 1,
        "capture_session_id": true,
        "responses": [
          {
            "jsonrpc": "2.0",
            "id": 2,
            "result": { "sessionId": "$SESSION_ID" }
          }
        ]
      }
    },
    {
      "request": {
        "jsonrpc": "2.0",
        "id": 3,
        "method": "session/prompt",
        "params": {
          "sessionId": "$SESSION_ID",
          "prompt": "hola"
        }
      },
      "expect": {
        "response_count": 3,
        "first_update_text": "echo:hola",
        "last_stop_reason": "end_turn",
        "responses": [
          {
            "jsonrpc": "2.0",
            "method": "session/update",
            "params": {
              "sessionId": "$SESSION_ID",
              "update": {
                "kind": "agent_message_chunk",
                "content": { "type": "text", "text": "echo:hola" }
              }
            }
          },
          {
            "jsonrpc": "2.0",
            "method": "session/update",
            "params": {
              "sessionId": "$SESSION_ID",
              "update": { "kind": "agent_message_end" }
            }
          },
          {
            "jsonrpc": "2.0",
            "id": 3,
            "result": {
              "stopReason": "end_turn",
              "content": [{ "type": "text", "text": "echo:hola" }],
              "text": "echo:hola",
              "output_text": "echo:hola"
            }
          }
        ]
      }
    },
    {
      "request": {
        "jsonrpc": "2.0",
        "id": 4,
        "method": "session/prompt",
        "params": {
          "sessionId": "$SESSION_ID",
          "prompt": {
            "messages": [
              { "role": "system", "content": "ignore" },
              {
                "role": "user",
                "content": [{ "type": "input_text", "text": "adios" }]
              }
            ]
          }
        }
      },
      "expect": {
        "response_count": 3,
        "first_update_text": "echo:adios",
        "last_stop_reason": "end_turn",
        "responses": [
          {
            "jsonrpc": "2.0",
            "method": "session/update",
            "params": {
              "sessionId": "$SESSION_ID",
              "update": {
                "kind": "agent_message_chunk",
                "content": { "type": "text", "text": "echo:adios" }
              }
            }
          },
          {
            "jsonrpc": "2.0",
            "method": "session/update",
            "params": {
              "sessionId": "$SESSION_ID",
              "update": { "kind": "agent_message_end" }
            }
          },
          {
            "jsonrpc": "2.0",
            "id": 4,
            "result": {
              "stopReason": "end_turn",
              "content": [{ "type": "text", "text": "echo:adios" }],
              "text": "echo:adios",
              "output_text": "echo:adios"
            }
          }
        ]
      }
    }
  ]
}
